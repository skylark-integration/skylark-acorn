/**
 * skylark-acorn - A version of acorn that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./identifier","./state","./unicode-property-data","./util"],function(e,t,a,r){"use strict";const{isIdentifierStart:n,isIdentifierChar:s}=e,{Parser:i}=t,{hasOwn:c,codePointToString:o}=r,u=i.prototype;function p(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function l(e){return e>=65&&e<=90||e>=97&&e<=122}u.validateRegExpFlags=function(e){const t=e.validFlags,a=e.flags;let r=!1,n=!1;for(let s=0;s<a.length;s++){const i=a.charAt(s);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),a.indexOf(i,s+1)>-1&&this.raise(e.start,"Duplicate regular expression flag"),"u"===i&&(r=!0),"v"===i&&(n=!0)}this.options.ecmaVersion>=15&&r&&n&&this.raise(e.start,"Invalid regular expression flag")},u.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},u.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(const t of e.backReferenceNames)-1===e.groupNames.indexOf(t)&&e.raise("Invalid named capture referenced")},u.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},u.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},u.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!(e.switchU?!this.regexp_eatAtom(e):!this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},u.regexp_eatAssertion=function(e){const t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){let t=!1;if(this.options.ecmaVersion>=9&&(t=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!t,!0}return e.pos=t,!1},u.regexp_eatQuantifier=function(e,t=!1){return!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},u.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},u.regexp_eatBracedQuantifier=function(e,t){const a=e.pos;if(e.eat(123)){let r=0,n=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue),e.eat(125)))return-1!==n&&n<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=a}return!1},u.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},u.regexp_eatReverseSolidusAtomEscape=function(e){const t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},u.regexp_eatUncapturingGroup=function(e){const t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},u.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},u.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},u.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},u.regexp_eatSyntaxCharacter=function(e){const t=e.current();return!!p(t)&&(e.lastIntValue=t,e.advance(),!0)},u.regexp_eatPatternCharacters=function(e){const t=e.pos;let a=0;for(;-1!==(a=e.current())&&!p(a);)e.advance();return e.pos!==t},u.regexp_eatExtendedPatternCharacter=function(e){const t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},u.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},u.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},u.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=o(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=o(e.lastIntValue);return!0}return!1},u.regexp_eatRegExpIdentifierStart=function(e){const t=e.pos,a=this.options.ecmaVersion>=11;let r=e.current(a);return e.advance(a),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,a)&&(r=e.lastIntValue),function(e){return n(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},u.regexp_eatRegExpIdentifierPart=function(e){const t=e.pos,a=this.options.ecmaVersion>=11;let r=e.current(a);return e.advance(a),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,a)&&(r=e.lastIntValue),function(e){return s(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},u.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},u.regexp_eatBackReference=function(e){const t=e.pos;if(this.regexp_eatDecimalEscape(e)){const a=e.lastIntValue;if(e.switchU)return a>e.maxBackReference&&(e.maxBackReference=a),!0;if(a<=e.numCapturingParens)return!0;e.pos=t}return!1},u.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},u.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},u.regexp_eatCControlLetter=function(e){const t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},u.regexp_eatZero=function(e){return 48===e.current()&&!f(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},u.regexp_eatControlEscape=function(e){const t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},u.regexp_eatControlLetter=function(e){const t=e.current();return!!l(t)&&(e.lastIntValue=t%32,e.advance(),!0)},u.regexp_eatRegExpUnicodeEscapeSequence=function(e,t=!1){const a=e.pos,r=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){const t=e.lastIntValue;if(r&&t>=55296&&t<=56319){const a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){const a=e.lastIntValue;if(a>=56320&&a<=57343)return e.lastIntValue=1024*(t-55296)+(a-56320)+65536,!0}e.pos=a,e.lastIntValue=t}return!0}if(r&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((n=e.lastIntValue)>=0&&n<=1114111))return!0;r&&e.raise("Invalid unicode escape"),e.pos=a}var n;return!1},u.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);const t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},u.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;let t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1};function g(e){return l(e)||95===e}function h(e){return g(e)||f(e)}function f(e){return e>=48&&e<=57}function x(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function d(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function _(e){return e>=48&&e<=55}return u.regexp_eatCharacterClassEscape=function(e){const t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),1;let a=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((a=80===t)||112===t)){let t;if(e.lastIntValue=-1,e.advance(),e.eat(123)&&(t=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return a&&2===t&&e.raise("Invalid property name"),t;e.raise("Invalid property name")}return 0},u.regexp_eatUnicodePropertyValueExpression=function(e){const t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){const t=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){const a=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,t,a),1}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){const t=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,t)}return 0},u.regexp_validateUnicodePropertyNameAndValue=function(e,t,a){c(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(a)||e.raise("Invalid property value")},u.regexp_validateUnicodePropertyNameOrValue=function(e,t){return e.unicodeProperties.binary.test(t)?1:e.switchV&&e.unicodeProperties.binaryOfStrings.test(t)?2:void e.raise("Invalid property name")},u.regexp_eatUnicodePropertyName=function(e){let t=0;for(e.lastStringValue="";g(t=e.current());)e.lastStringValue+=o(t),e.advance();return""!==e.lastStringValue},u.regexp_eatUnicodePropertyValue=function(e){let t=0;for(e.lastStringValue="";h(t=e.current());)e.lastStringValue+=o(t),e.advance();return""!==e.lastStringValue},u.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},u.regexp_eatCharacterClass=function(e){if(e.eat(91)){const t=e.eat(94),a=this.regexp_classContents(e);return e.eat(93)||e.raise("Unterminated character class"),t&&2===a&&e.raise("Negated character class may contain strings"),!0}return!1},u.regexp_classContents=function(e){return 93===e.current()?1:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),1)},u.regexp_nonEmptyClassRanges=function(e){for(;this.regexp_eatClassAtom(e);){const t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){const a=e.lastIntValue;!e.switchU||-1!==t&&-1!==a||e.raise("Invalid character class"),-1!==t&&-1!==a&&t>a&&e.raise("Range out of order in character class")}}},u.regexp_eatClassAtom=function(e){const t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){const t=e.current();(99===t||_(t))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}const a=e.current();return 93!==a&&(e.lastIntValue=a,e.advance(),!0)},u.regexp_eatClassEscape=function(e){const t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},u.regexp_classSetExpression=function(e){let t,a=1;if(this.regexp_eatClassSetRange(e));else if(t=this.regexp_eatClassSetOperand(e)){2===t&&(a=2);const r=e.pos;for(;e.eatChars([38,38]);)38!==e.current()&&(t=this.regexp_eatClassSetOperand(e))?2!==t&&(a=1):e.raise("Invalid character in character class");if(r!==e.pos)return a;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise("Invalid character in character class");if(r!==e.pos)return a}else e.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(e)){if(!(t=this.regexp_eatClassSetOperand(e)))return a;2===t&&(a=2)}},u.regexp_eatClassSetRange=function(e){const t=e.pos;if(this.regexp_eatClassSetCharacter(e)){const a=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){const t=e.lastIntValue;return-1!==a&&-1!==t&&a>t&&e.raise("Range out of order in character class"),!0}e.pos=t}return!1},u.regexp_eatClassSetOperand=function(e){return this.regexp_eatClassSetCharacter(e)?1:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)},u.regexp_eatNestedClass=function(e){const t=e.pos;if(e.eat(91)){const a=e.eat(94),r=this.regexp_classContents(e);if(e.eat(93))return a&&2===r&&e.raise("Negated character class may contain strings"),r;e.pos=t}if(e.eat(92)){const a=this.regexp_eatCharacterClassEscape(e);if(a)return a;e.pos=t}return null},u.regexp_eatClassStringDisjunction=function(e){const t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){const t=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return t}else e.raise("Invalid escape");e.pos=t}return null},u.regexp_classStringDisjunctionContents=function(e){let t=this.regexp_classString(e);for(;e.eat(124);)2===this.regexp_classString(e)&&(t=2);return t},u.regexp_classString=function(e){let t=0;for(;this.regexp_eatClassSetCharacter(e);)t++;return 1===t?1:2},u.regexp_eatClassSetCharacter=function(e){const t=e.pos;if(e.eat(92))return!(!this.regexp_eatCharacterEscape(e)&&!this.regexp_eatClassSetReservedPunctuator(e))||(e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1));const a=e.current();return!(a<0||a===e.lookahead()&&function(e){return 33===e||e>=35&&e<=38||e>=42&&e<=44||46===e||e>=58&&e<=64||94===e||96===e||126===e}(a))&&(!function(e){return 40===e||41===e||45===e||47===e||e>=91&&e<=93||e>=123&&e<=125}(a)&&(e.advance(),e.lastIntValue=a,!0))},u.regexp_eatClassSetReservedPunctuator=function(e){const t=e.current();return!!function(e){return 33===e||35===e||37===e||38===e||44===e||45===e||e>=58&&e<=62||64===e||96===e||126===e}(t)&&(e.lastIntValue=t,e.advance(),!0)},u.regexp_eatClassControlLetter=function(e){const t=e.current();return!(!f(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},u.regexp_eatHexEscapeSequence=function(e){const t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},u.regexp_eatDecimalDigits=function(e){const t=e.pos;let a=0;for(e.lastIntValue=0;f(a=e.current());)e.lastIntValue=10*e.lastIntValue+(a-48),e.advance();return e.pos!==t},u.regexp_eatHexDigits=function(e){const t=e.pos;let a=0;for(e.lastIntValue=0;x(a=e.current());)e.lastIntValue=16*e.lastIntValue+d(a),e.advance();return e.pos!==t},u.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){const t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){const a=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*a+e.lastIntValue:e.lastIntValue=8*t+a}else e.lastIntValue=t;return!0}return!1},u.regexp_eatOctalDigit=function(e){const t=e.current();return _(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},u.regexp_eatFixedHexDigits=function(e,t){const a=e.pos;e.lastIntValue=0;for(let r=0;r<t;++r){const t=e.current();if(!x(t))return e.pos=a,!1;e.lastIntValue=16*e.lastIntValue+d(t),e.advance()}return!0},{RegExpValidationState:class{constructor(e){this.parser=e,this.validFlags=`gim${e.options.ecmaVersion>=6?"uy":""}${e.options.ecmaVersion>=9?"s":""}${e.options.ecmaVersion>=13?"d":""}${e.options.ecmaVersion>=15?"v":""}`,this.unicodeProperties=a[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]}reset(e,t,a){const r=-1!==a.indexOf("v"),n=-1!==a.indexOf("u");this.start=0|e,this.source=t+"",this.flags=a,r&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=n&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=n&&this.parser.options.ecmaVersion>=9)}raise(e){this.parser.raiseRecoverable(this.start,`Invalid regular expression: /${this.source}/: ${e}`)}at(e,t=!1){const a=this.source,r=a.length;if(e>=r)return-1;const n=a.charCodeAt(e);if(!t&&!this.switchU||n<=55295||n>=57344||e+1>=r)return n;const s=a.charCodeAt(e+1);return s>=56320&&s<=57343?(n<<10)+s-56613888:n}nextIndex(e,t=!1){const a=this.source,r=a.length;if(e>=r)return r;let n,s=a.charCodeAt(e);return!t&&!this.switchU||s<=55295||s>=57344||e+1>=r||(n=a.charCodeAt(e+1))<56320||n>57343?e+1:e+2}current(e=!1){return this.at(this.pos,e)}lookahead(e=!1){return this.at(this.nextIndex(this.pos,e),e)}advance(e=!1){this.pos=this.nextIndex(this.pos,e)}eat(e,t=!1){return this.current(t)===e&&(this.advance(t),!0)}eatChars(e,t=!1){let a=this.pos;for(const r of e){const e=this.at(a,t);if(-1===e||e!==r)return!1;a=this.nextIndex(a,t)}return this.pos=a,!0}}}});
//# sourceMappingURL=sourcemaps/regexp.js.map
